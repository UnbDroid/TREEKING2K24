#include "Arduino.h"
#include "Volante.h"
#include "Giroscopio.h"
#include "MotorDC.h"
#include "Pinos.h"
#include "Robo.h"
#include "Tempo.h"

//* Este arquivo contém o código principal do robô, que junta todas as funções e estrutura a lógica principal do robô

//TODO: Mudar o README para ter um tutorial de como usar o código
//TODO: Adicionar comentários explicativos no código

// Declarações dos objetos -----------------------------------------------------------------------------------------------------------------------------------------------------------

MotorDC motor_dc(ENCA, ENCB, PWM, IN1, IN2);
// Volante volante(SERVO);
// Giroscopio giroscopio;
// Robo robo(motor_dc, volante, giroscopio);

// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

// Declaração das variáveis de tempo ------------------------------------------------------------------------------------------------------------------------------------------------

long T;
long prevT; 
double dt;

// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

void interrupcao_encoder() {
  motor_dc.ler_encoder();
}

// Funções principais do código ----------------------------------------------------------------------------------------------------------------------------------------------------

void setup() {

  // Início da comunicação serial
  Serial.begin(9600);

  

  //! Inicialização dos objetos (oficial) -------------------------------------------------------------------------------------------------------------------------------------------
  
  // robo.ligar_robo();

  //! --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------



  // Inicialização dos objetos (teste) ---------------------------------------------------------------------------------------------------------------------------------------------

  // volante.inicializar_volante();
  attachInterrupt(digitalPinToInterrupt(ENCA), interrupcao_encoder, RISING);
  // giroscopio.ligar_mpu();

  // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  // Funções de teste ---------------------------------------------------------------------------------------------------------------------------------------------------------------

  // motor_dc.andar_reto_cm(10, 80);
  // robo.virar_robo(90);

  // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

}

void loop() {
  
  // Núcleo do código ---------------------------------------------------------------------------------------------------------------------------------------------------------------
  
  atualizar_tempo();

  // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------





  // Funções de teste ---------------------------------------------------------------------------------------------------------------------------------------------------------------

  // robo.virar_robo(90);
  motor_dc.andar_reto(30); //! Ajustar aqui a velocidade em RPM
  // analogWrite(PWM, 100);
  // digitalWrite(IN1, HIGH);
  // digitalWrite(IN2, LOW);
  // motor_dc.ler_encoder();
  Serial.print("Posição: ");
  Serial.println(motor_dc.posi);
  // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  // delay(10);

}